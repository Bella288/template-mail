<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Template Builder</title>
    <style>
        /* Your CSS remains unchanged */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .components-panel {
            width: 250px;
            background-color: #fff;
            padding: 1rem;
            border-right: 1px solid #e1e4e8;
            overflow-y: auto;
        }
        
        .canvas-container {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #f5f7f9;
        }
        
        .properties-panel {
            width: 300px;
            background-color: #fff;
            padding: 1rem;
            border-left: 1px solid #e1e4e8;
            overflow-y: auto;
        }
        
        .component-item {
            background-color: #f5f7f9;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s ease;
        }
        
        .component-item:hover {
            background-color: #e6f7ff;
            border-color: #91d5ff;
            transform: translateY(-2px);
        }
        
        .component-item:active {
            cursor: grabbing;
        }
        
        .email-canvas {
            background-color: white;
            border: 1px dashed #ccc;
            min-height: 600px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .canvas-placeholder {
            text-align: center;
            color: #999;
            padding: 3rem;
        }
        
        .email-component {
            border: 1px solid #e1e4e8;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: white;
            position: relative;
        }
        
        .component-tools {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #f5f7f9;
            padding: 0.25rem;
            border-left: 1px solid #e1e4e8;
            border-bottom: 1px solid #e1e4e8;
            display: flex;
        }
        
        .component-tools button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 0.25rem;
            font-size: 0.75rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background-color: #6e8efb;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5a7dfa;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid #6e8efb;
            color: #6e8efb;
        }
        
        .btn-outline:hover {
            background-color: #f0f5ff;
        }
        
        .property-group {
            margin-bottom: 1.5rem;
        }
        
        .property-group h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 0.75rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
            color: #666;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .header-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .drag-over {
            background-color: #e6f7ff;
            border: 2px dashed #1890ff;
        }
        
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .export-option {
            padding: 1rem;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .export-option:hover {
            background-color: #f0f5ff;
            border-color: #6e8efb;
        }
        
        h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #444;
        }
        
        .code-container {
            background-color: #f5f7f9;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        pre {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
        }

        .variable-placeholder {
            background-color: #f0f5ff;
            padding: 4px 8px;
            border-radius: 4px;
            color: #6e8efb;
            border: 1px dashed #91d5ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Email Template Builder</div>
            <div class="header-buttons">
                <button class="btn btn-outline" id="variables-btn">Variables</button>
                <button class="btn btn-outline" id="preview-btn">Preview</button>
                <button class="btn btn-primary" id="export-btn">Export</button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="components-panel">
                <h2>Components</h2>
                <div class="component-item" draggable="true" data-type="header">
                    <strong>Header</strong>
                    <p>Email header with logo and navigation</p>
                </div>
                <div class="component-item" draggable="true" data-type="hero">
                    <strong>Hero Section</strong>
                    <p>Large banner with call-to-action</p>
                </div>
                <div class="component-item" draggable="true" data-type="text">
                    <strong>Text Block</strong>
                    <p>Simple text content</p>
                </div>
                <div class="component-item" draggable="true" data-type="image">
                    <strong>Image</strong>
                    <p>Single image with optional link</p>
                </div>
                <div class="component-item" draggable="true" data-type="button">
                    <strong>Button</strong>
                    <p>Call-to-action button</p>
                </div>
                <div class="component-item" draggable="true" data-type="footer">
                    <strong>Footer</strong>
                    <p>Email footer with links and copyright</p>
                </div>
                
                <h2 style="margin-top: 20px;">Variables</h2>
                <div class="component-item" draggable="true" data-type="variable" data-var="{rName}">
                    <strong>Recipient Name</strong>
                    <p>{rName} - Will be replaced with actual name</p>
                </div>
                <div class="component-item" draggable="true" data-type="variable" data-var="{sName}">
                    <strong>Sender Name</strong>
                    <p>{sName} - Will be replaced with sender name</p>
                </div>
                <div class="component-item" draggable="true" data-type="variable" data-var="{sEmail}">
                    <strong>Sender Email</strong>
                    <p>{sEmail} - Will be replaced with sender email</p>
                </div>
                <div class="component-item" draggable="true" data-type="variable" data-var="{rEmail}">
                    <strong>Recipient Email</strong>
                    <p>{rEmail} - Will be replaced with recipient email</p>
                </div>
                <div class="component-item" draggable="true" data-type="variable" data-var="{sDate}">
                    <strong>Send Date</strong>
                    <p>{sDate} - Will be replaced with send date</p>
                </div>
            </div>
            
            <div class="canvas-container">
                <h2>Canvas</h2>
                <div class="email-canvas" id="email-canvas">
                    <div class="canvas-placeholder">
                        <p>Drag components from the left panel to build your email template</p>
                    </div>
                </div>
            </div>
            
            <div class="properties-panel">
                <h2>Properties</h2>
                <div id="property-editor">
                    <p>Select a component to edit its properties</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="preview-modal" id="preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Email Preview</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="preview-content"></div>
        </div>
    </div>
    
    <div class="preview-modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Template</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="export-options">
                <div class="export-option" id="export-html">Export as HTML</div>
                <div class="export-option" id="export-copy">Copy to Clipboard</div>
            </div>
            <div class="code-container" id="export-code-container" style="display: none;">
                <pre id="export-code"></pre>
            </div>
        </div>
    </div>

    <div class="preview-modal" id="variables-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Variables</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="property-group">
                <div class="form-group">
                    <label for="sender-name">Sender Name</label>
                    <input type="text" id="sender-name" placeholder="e.g., John Doe">
                </div>
                <div class="form-group">
                    <label for="sender-email">Sender Email</label>
                    <input type="email" id="sender-email" placeholder="e.g., john@example.com">
                </div>
                <div class="form-group">
                    <label for="recipient-name">Recipient Name</label>
                    <input type="text" id="recipient-name" placeholder="e.g., Jane Smith">
                </div>
                <div class="form-group">
                    <label for="recipient-email">Recipient Email</label>
                    <input type="email" id="recipient-email" placeholder="e.g., jane@example.com">
                </div>
                <div class="form-group">
                    <label for="send-date">Send Date</label>
                    <input type="date" id="send-date">
                </div>
                <button class="btn btn-primary" id="save-variables">Save Variables</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
        // DOM Elements
        const emailCanvas = document.getElementById('email-canvas');
        const propertyEditor = document.getElementById('property-editor');
        const previewModal = document.getElementById('preview-modal');
        const exportModal = document.getElementById('export-modal');
        const variablesModal = document.getElementById('variables-modal');
        const previewContent = document.getElementById('preview-content');
        const exportCode = document.getElementById('export-code');
        const exportCodeContainer = document.getElementById('export-code-container');
        const toast = document.getElementById('toast');
        
        // Buttons
        const previewBtn = document.getElementById('preview-btn');
        const exportBtn = document.getElementById('export-btn');
        const variablesBtn = document.getElementById('variables-btn');
        const saveVariablesBtn = document.getElementById('save-variables');
        
        // Variable Inputs
        const senderNameInput = document.getElementById('sender-name');
        const senderEmailInput = document.getElementById('sender-email');
        const recipientNameInput = document.getElementById('recipient-name');
        const recipientEmailInput = document.getElementById('recipient-email');
        const sendDateInput = document.getElementById('send-date');
        
        // Close modal buttons
        const closeModalButtons = document.querySelectorAll('.close-modal');
        
        // Store components and variables
        let components = [];
        let variables = {
            senderName: '',
            senderEmail: '',
            recipientName: '',
            recipientEmail: '',
            sendDate: ''
        };
        
        // Variable mapping
        const variableMap = {
            '{sName}': 'senderName',
            '{sEmail}': 'senderEmail',
            '{rName}': 'recipientName',
            '{rEmail}': 'recipientEmail',
            '{sDate}': 'sendDate'
        };
        
        // Initialize the application
        function init() {
            // Set today's date as default for send date
            const today = new Date().toISOString().split('T')[0];
            sendDateInput.value = today;
            variables.sendDate = today;
            
            // Load saved variables from localStorage if available
            loadSavedVariables();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Load saved variables from localStorage
        function loadSavedVariables() {
            const savedVariables = localStorage.getItem('emailTemplateVariables');
            if (savedVariables) {
                const parsedVariables = JSON.parse(savedVariables);
                variables = {...variables, ...parsedVariables};
                
                // Update input fields
                senderNameInput.value = variables.senderName || '';
                senderEmailInput.value = variables.senderEmail || '';
                recipientNameInput.value = variables.recipientName || '';
                recipientEmailInput.value = variables.recipientEmail || '';
                sendDateInput.value = variables.sendDate || new Date().toISOString().split('T')[0];
            }
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Drag and drop for components
            setupDragAndDrop();
            
            // Modal buttons
            previewBtn.addEventListener('click', showPreview);
            exportBtn.addEventListener('click', showExportModal);
            variablesBtn.addEventListener('click', showVariablesModal);
            saveVariablesBtn.addEventListener('click', saveVariables);
            
            // Close modals
            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    previewModal.style.display = 'none';
                    exportModal.style.display = 'none';
                    variablesModal.style.display = 'none';
                });
            });
            
            // Export options
            document.getElementById('export-html').addEventListener('click', exportAsHTML);
            document.getElementById('export-copy').addEventListener('click', copyToClipboard);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === previewModal) previewModal.style.display = 'none';
                if (e.target === exportModal) exportModal.style.display = 'none';
                if (e.target === variablesModal) variablesModal.style.display = 'none';
            });
        }
        
        // Set up drag and drop functionality
        function setupDragAndDrop() {
            const componentItems = document.querySelectorAll('.component-item');
            
            componentItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        type: item.dataset.type,
                        variable: item.dataset.var || null
                    }));
                });
            });
            
            emailCanvas.addEventListener('dragover', (e) => {
                e.preventDefault();
                emailCanvas.classList.add('drag-over');
            });
            
            emailCanvas.addEventListener('dragleave', () => {
                emailCanvas.classList.remove('drag-over');
            });
            
            emailCanvas.addEventListener('drop', (e) => {
                e.preventDefault();
                emailCanvas.classList.remove('drag-over');
                
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                
                if (data.type === 'variable') {
                    addVariableToCanvas(data.variable);
                } else {
                    addComponentToCanvas(data.type);
                }
            });
        }
        
        // Add a variable to the canvas
        function addVariableToCanvas(variable) {
            // Remove the placeholder if it exists
            const placeholder = emailCanvas.querySelector('.canvas-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            const variableElement = document.createElement('div');
            variableElement.className = 'email-component';
            variableElement.innerHTML = `
                <span class="variable-placeholder">${variable}</span>
                <div class="component-tools">
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </div>
            `;
            
            // Add event listeners for the tools
            const deleteBtn = variableElement.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', () => {
                variableElement.remove();
                updateComponentsArray();
                checkEmptyCanvas();
            });
            
            emailCanvas.appendChild(variableElement);
            updateComponentsArray();
        }
        
        // Add a component to the canvas
        function addComponentToCanvas(type) {
            // Remove the placeholder if it exists
            const placeholder = emailCanvas.querySelector('.canvas-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            let componentHtml = '';
            let defaultContent = '';
            
            switch (type) {
                case 'header':
                    defaultContent = '<h1>Email Header</h1><p>Company Logo and Navigation</p>';
                    break;
                case 'hero':
                    defaultContent = '<div style="text-align: center; padding: 40px; background-color: #f0f0f0;"><h2>Hero Section</h2><p>Engaging content goes here</p></div>';
                    break;
                case 'text':
                    defaultContent = '<p>This is a text block. You can edit this content to add your own text.</p>';
                    break;
                case 'image':
                    defaultContent = '<img src="https://via.placeholder.com/600x300" alt="Placeholder Image" style="max-width: 100%; height: auto;">';
                    break;
                case 'button':
                    defaultContent = '<div style="text-align: center; margin: 20px 0;"><a href="#" style="display: inline-block; padding: 12px 24px; background-color: #6e8efb; color: white; text-decoration: none; border-radius: 4px;">Click Me</a></div>';
                    break;
                case 'footer':
                    defaultContent = '<div style="text-align: center; padding: 20px; background-color: #f5f5f5; margin-top: 20px;"><p>&copy; 2023 Company Name. All rights reserved.</p></div>';
                    break;
            }
            
            componentHtml = `
                <div class="component-content">${defaultContent}</div>
                <div class="component-tools">
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </div>
            `;
            
            const componentElement = document.createElement('div');
            componentElement.className = 'email-component';
            componentElement.setAttribute('data-type', type);
            componentElement.innerHTML = componentHtml;
            
            // Add event listeners for the tools
            const editBtn = componentElement.querySelector('.edit-btn');
            const deleteBtn = componentElement.querySelector('.delete-btn');
            
            editBtn.addEventListener('click', () => {
                showPropertyEditor(componentElement, type);
            });
            
            deleteBtn.addEventListener('click', () => {
                componentElement.remove();
                updateComponentsArray();
                checkEmptyCanvas();
            });
            
            // Also make the whole component clickable for editing
            componentElement.addEventListener('click', (e) => {
                if (e.target === componentElement || e.target.classList.contains('component-content')) {
                    showPropertyEditor(componentElement, type);
                }
            });
            
            emailCanvas.appendChild(componentElement);
            updateComponentsArray();
        }
        
        // Show property editor for a component
        function showPropertyEditor(component, type) {
            let editorHtml = '';
            
            switch (type) {
                case 'text':
                    const currentText = component.querySelector('.component-content').innerHTML;
                    editorHtml = `
                        <div class="property-group">
                            <h3>Text Content</h3>
                            <div class="form-group">
                                <label for="text-content">Text</label>
                                <textarea id="text-content" rows="6">${currentText}</textarea>
                            </div>
                            <button class="btn btn-primary" id="save-text">Save Changes</button>
                        </div>
                    `;
                    break;
                case 'image':
                    const currentSrc = component.querySelector('img')?.src || '';
                    editorHtml = `
                        <div class="property-group">
                            <h3>Image Properties</h3>
                            <div class="form-group">
                                <label for="image-src">Image URL</label>
                                <input type="text" id="image-src" value="${currentSrc}" placeholder="https://example.com/image.jpg">
                            </div>
                            <div class="form-group">
                                <label for="image-alt">Alt Text</label>
                                <input type="text" id="image-alt" value="${component.querySelector('img')?.alt || ''}" placeholder="Description of image">
                            </div>
                            <div class="form-group">
                                <label for="image-link">Link URL (optional)</label>
                                <input type="text" id="image-link" value="${component.querySelector('a')?.href || ''}" placeholder="https://example.com">
                            </div>
                            <button class="btn btn-primary" id="save-image">Save Changes</button>
                        </div>
                    `;
                    break;
                case 'button':
                    const currentButton = component.querySelector('a');
                    editorHtml = `
                        <div class="property-group">
                            <h3>Button Properties</h3>
                            <div class="form-group">
                                <label for="button-text">Button Text</label>
                                <input type="text" id="button-text" value="${currentButton.textContent}" placeholder="Button Text">
                            </div>
                            <div class="form-group">
                                <label for="button-link">Button Link</label>
                                <input type="text" id="button-link" value="${currentButton.href}" placeholder="https://example.com">
                            </div>
                            <div class="form-group">
                                <label for="button-color">Button Color</label>
                                <input type="color" id="button-color" value="${currentButton.style.backgroundColor || '#6e8efb'}">
                            </div>
                            <button class="btn btn-primary" id="save-button">Save Changes</button>
                        </div>
                    `;
                    break;
                default:
                    editorHtml = `<p>No properties to edit for this component.</p>`;
            }
            
            propertyEditor.innerHTML = editorHtml;
            
            // Set up save handlers based on component type
            if (type === 'text') {
                document.getElementById('save-text').addEventListener('click', () => {
                    const newContent = document.getElementById('text-content').value;
                    component.querySelector('.component-content').innerHTML = newContent;
                    updateComponentsArray();
                });
            } else if (type === 'image') {
                document.getElementById('save-image').addEventListener('click', () => {
                    const src = document.getElementById('image-src').value;
                    const alt = document.getElementById('image-alt').value;
                    const link = document.getElementById('image-link').value;
                    
                    let imageHtml = `<img src="${src}" alt="${alt}" style="max-width: 100%; height: auto;">`;
                    
                    if (link) {
                        imageHtml = `<a href="${link}">${imageHtml}</a>`;
                    }
                    
                    component.querySelector('.component-content').innerHTML = imageHtml;
                    updateComponentsArray();
                });
            } else if (type === 'button') {
                document.getElementById('save-button').addEventListener('click', () => {
                    const text = document.getElementById('button-text').value;
                    const link = document.getElementById('button-link').value;
                    const color = document.getElementById('button-color').value;
                    
                    const buttonHtml = `
                        <a href="${link}" style="display: inline-block; padding: 12px 24px; background-color: ${color}; color: white; text-decoration: none; border-radius: 4px;">${text}</a>
                    `;
                    
                    component.querySelector('.component-content').innerHTML = buttonHtml;
                    updateComponentsArray();
                });
            }
        }
        
        // Update the components array from the DOM
        function updateComponentsArray() {
            components = [];
            const componentElements = emailCanvas.querySelectorAll('.email-component');
            
            componentElements.forEach(element => {
                if (element.querySelector('.variable-placeholder')) {
                    // It's a variable
                    components.push({
                        type: 'variable',
                        content: element.querySelector('.variable-placeholder').textContent
                    });
                } else {
                    // It's a regular component
                    components.push({
                        type: element.dataset.type,
                        content: element.querySelector('.component-content').innerHTML
                    });
                }
            });
        }
        
        // Check if canvas is empty and show placeholder
        function checkEmptyCanvas() {
            if (emailCanvas.children.length === 0) {
                const placeholder = document.createElement('div');
                placeholder.className = 'canvas-placeholder';
                placeholder.innerHTML = '<p>Drag components from the left panel to build your email template</p>';
                emailCanvas.appendChild(placeholder);
            }
        }
        
        // Show preview modal
        function showPreview() {
            updateComponentsArray();
            
            let previewHtml = '';
            
            components.forEach(component => {
                if (component.type === 'variable') {
                    // Replace variable with actual value
                    const variableKey = variableMap[component.content];
                    const variableValue = variables[variableKey] || component.content;
                    previewHtml += `<div class="variable-preview">${variableValue}</div>`;
                } else {
                    previewHtml += component.content;
                }
            });
            
            previewContent.innerHTML = previewHtml;
            previewModal.style.display = 'flex';
        }
        
        // Show export modal
        function showExportModal() {
            updateComponentsArray();
            exportModal.style.display = 'flex';
            exportCodeContainer.style.display = 'none';
        }
        
        // Show variables modal
        function showVariablesModal() {
            variablesModal.style.display = 'flex';
        }
        
        // Save variables
        function saveVariables() {
            variables = {
                senderName: senderNameInput.value,
                senderEmail: senderEmailInput.value,
                recipientName: recipientNameInput.value,
                recipientEmail: recipientEmailInput.value,
                sendDate: sendDateInput.value
            };
            
            // Save to localStorage
            localStorage.setItem('emailTemplateVariables', JSON.stringify(variables));
            
            // Show success message
            showToast('Variables saved successfully!');
            
            // Close modal after a short delay
            setTimeout(() => {
                variablesModal.style.display = 'none';
            }, 1000);
        }
        
        // Export as HTML
        function exportAsHTML() {
            updateComponentsArray();
            
            let finalHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Email Template</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            max-width: 600px;
                            margin: 0 auto;
                        }
                        .variable-placeholder {
                            background-color: #f0f5ff;
                            padding: 4px 8px;
                            border-radius: 4px;
                            color: #6e8efb;
                            border: 1px dashed #91d5ff;
                        }
                    </style>
                </head>
                <body>
            `;
            
            components.forEach(component => {
                if (component.type === 'variable') {
                    const variableKey = variableMap[component.content];
                    const variableValue = variables[variableKey] || component.content;
                    finalHtml += `<span class="variable-placeholder">${variableValue}</span>`;
                } else {
                    finalHtml += component.content;
                }
            });
            
            finalHtml += `
                </body>
                </html>
            `;
            
            exportCode.textContent = finalHtml;
            exportCodeContainer.style.display = 'block';
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            updateComponentsArray();
            
            let finalHtml = '';
            
            components.forEach(component => {
                if (component.type === 'variable') {
                    const variableKey = variableMap[component.content];
                    const variableValue = variables[variableKey] || component.content;
                    finalHtml += variableValue;
                } else {
                    finalHtml += component.content;
                }
            });
            
            navigator.clipboard.writeText(finalHtml).then(() => {
                showToast('Copied to clipboard!');
            }).catch(err => {
                showToast('Failed to copy to clipboard');
                console.error('Could not copy text: ', err);
            });
        }
        
        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>
